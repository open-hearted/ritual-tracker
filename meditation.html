<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç‘æƒ³ãƒˆãƒ©ãƒƒã‚«ãƒ¼</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="style-overrides-meditation.css" />
  <!-- äº’æ›æ€§/ã‚¿ã‚¤ãƒ—ãƒŸã‚¹ç”±æ¥ã® 404 å›é¿ç”¨ï¼ˆstyles.css ã‚’è¦æ±‚ã•ã‚Œã¦ã‚‚åŒã˜å†…å®¹ã‚’æä¾›ï¼‰ -->
  <link rel="stylesheet" href="styles.css" disabled />
  <!-- favicon 404 å›é¿ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰ -->
  <link rel="icon" href="data:,">
  <!-- Supabase JS (ä»»æ„åŒæœŸã§ä½¿ç”¨) ç„¡åŠ¹åŒ–è¦æ±‚ã«ã‚ˆã‚Šã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script> -->
  <script defer src="coworking-chekcin.js"></script>
</head>
<body>
  <div class="container compact">

    <div class="card cal-card">
      <div class="grid" id="dowRow"></div>
      <div class="grid" id="calGrid" aria-live="polite"></div>
      <div class="cal-head" style="margin-top:10px;">
        <div class="controls">
          <button id="prevBtn">â—€ å‰æœˆ</button>
          <div class="cal-title" id="monthLabel"></div>
          <button id="nextBtn">æ¬¡æœˆ â–¶</button>
        </div>
      </div>
      <div id="debug" style="margin-top:6px;font-size:11px;color:#ffdede"></div>
      <div class="stats" id="stats"></div>
    </div>

    <div class="top-bar" style="margin-top:12px;">
      <div class="app-title">ç‘æƒ³</div>
      <div class="quick-actions">
      </div>
    </div>

    <div class="card mini" id="s3Card">
      <details>
        <summary>åŒæœŸ</summary>
        <div class="row tight" style="margin-top:4px; gap:6px">
          <input id="s3DocId" placeholder="docId" />
          <span style="display:flex;align-items:center;gap:4px;flex:1;">
            <input id="s3Passphrase" placeholder="E2E pass" type="password" style="flex:1;" />
            <button type="button" id="togglePassMed" title="è¡¨ç¤º/éè¡¨ç¤º" style="padding:2px 6px;font-size:11px;">ğŸ‘</button>
          </span>
          <input id="s3Password" placeholder="APP_PASSWORD" type="password" />
        </div>
        <div class="row tight" style="margin-top:4px; gap:6px">
          <button id="s3Push">ä¿å­˜</button>
          <button id="s3Pull">å¾©å…ƒ</button>
          <label class="auto-restore"><input type="checkbox" id="s3AutoRestore" />è‡ªå‹•</label>
        </div>
        <div id="syncStatus" style="margin-top:6px;font-size:11px;color:#8ab4ff;white-space:pre-line">(sync idle)</div>
      </details>
    </div>
  </div>
  <!-- â–¼ è¿½åŠ : ç‘æƒ³ã‚¿ã‚¤ãƒãƒ¼ï¼ˆæ—¢å®š30åˆ†ã¯JSã§è¨­å®šã€å…¥åŠ›ã¸è‡ªå‹•ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã—ã¾ã›ã‚“ï¼‰ -->
  <div id="medEditor" class="med-editor" hidden aria-hidden="true">
    <div class="card" style="max-width:420px;margin:10px auto;">
      <h3 style="margin-top:0;">ã‚¿ã‚¤ãƒãƒ¼</h3>
      <div class="row" style="gap:8px;align-items:center;">
        <label for="medMinutes" style="min-width:3em;">åˆ†</label>
        <input id="medMinutes" data-role="med-minutes" type="number" min="1" step="1" inputmode="numeric" placeholder="30" />
      </div>
      <div class="row" style="gap:8px;margin-top:10px;">
        <button id="medStartBtn" data-med-start class="primary-big-med" type="button">é–‹å§‹</button>
        <button id="medCancelBtn" type="button">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      </div>
    </div>
  </div>
  <!-- â–² è¿½åŠ ã“ã“ã¾ã§ -->
  <script>
  // UIè¨­å®šï¼ˆç‘æƒ³ã‚¿ã‚¤ãƒãƒ¼ï¼‰
  const __medUI = {
    TIMER_DEFAULT_MIN: 30,
    TIMER_AUTOFOCUS: false, // å…¥åŠ›æ¬„ã«è‡ªå‹•ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã•ã›ãªã„
  };

  // æ—¢å®šåˆ†æ•°ã®è¨­å®šï¼ˆç©ºã‚„ä¸æ­£å€¤ãªã‚‰30åˆ†ã‚’å…¥ã‚Œã‚‹ï¼‰
  function ensureDefaultMinutes(root=document){
    const minInp =
      root.getElementById?.('medMinutes') ||
      root.querySelector?.('[data-role="med-minutes"]') ||
      root.querySelector?.('input[name="med-minutes"]');
    if(minInp){
      const n = Number(minInp.value);
      if(!minInp.value || !Number.isFinite(n) || n <= 0){
        minInp.value = __medUI.TIMER_DEFAULT_MIN;
      }
      minInp.setAttribute('inputmode','numeric');
      minInp.setAttribute('min','1');
      minInp.setAttribute('step','1');
    }
  }

  // é–‹å§‹ãƒœã‚¿ãƒ³ã‚’å¤§ããè¦‹ã‚„ã™ãï¼ˆã‚¯ãƒ©ã‚¹ä»˜ä¸ï¼‰
  function styleStartButton(root=document){
    const startBtn =
      root.querySelector?.('[data-med-start]') ||
      root.getElementById?.('medStartBtn') ||
      root.getElementById?.('startTimerBtn') ||
      root.querySelector?.('.start-timer');
    if(startBtn){
      startBtn.classList.add('primary-big-med');
      startBtn.setAttribute('aria-label', 'ç‘æƒ³ã‚’é–‹å§‹');
    }
  }

  // å…¥åŠ›æ¬„ã¸ã®è‡ªå‹•ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’æŠ‘æ­¢
  function disableTimerAutoFocusOnce(root=document){
    if(__medUI.TIMER_AUTOFOCUS) return;
    setTimeout(()=>{
      const modal = root.getElementById?.('medEditor')
        || root.querySelector?.('.med-editor, .med-modal, [data-med-editor]');
      if(!modal) return;
      const ae = root.activeElement;
      if(ae && modal.contains(ae) && (ae.tagName === 'INPUT' || ae.tagName === 'TEXTAREA')){
        ae.blur();
      }
    }, 30);
  }

  // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹ãƒœã‚¿ãƒ³ã¸ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
  function focusStartButton(root=document){
    setTimeout(()=>{
      const btn =
        root.querySelector?.('[data-med-start]') ||
        root.getElementById?.('medStartBtn') ||
        root.getElementById?.('startTimerBtn') ||
        root.querySelector?.('.start-timer');
      if(btn && typeof btn.focus === 'function') btn.focus();
    }, 0);
  }

  // medEditor ã®é–‹é–‰ã‚’ç›£è¦–ã—ã¦ã€é–‹ã„ãŸã‚‰é©ç”¨
  (function observeMedEditorOpen(){
    const modal = document.getElementById('medEditor');
    if(!modal){
      const mo = new MutationObserver((muts)=>{
        for(const m of muts){
          for(const n of m.addedNodes){
            if(n instanceof HTMLElement && n.id === 'medEditor'){
              mo.disconnect();
              observeMedEditorOpen();
              return;
            }
          }
        }
      });
      mo.observe(document.documentElement, { childList:true, subtree:true });
      return;
    }

    // åˆæœŸã¯å¿…ãšé–‰ã˜ã‚‹ï¼ˆè¦†ã„é˜²æ­¢ã®ã‚»ãƒ¼ãƒ•ã‚¬ãƒ¼ãƒ‰ï¼‰
    modal.hidden = true;
    modal.setAttribute('aria-hidden','true');
    modal.classList.remove('open');
    modal.style.display = 'none';

    // ã€Œé–‹ã„ã¦ã„ã‚‹ã€åˆ¤å®šã¯ class/aria ã®ã¿å‚ç…§ï¼ˆcomputedStyle ã«é ¼ã‚‰ãªã„ï¼‰
    const isOpen = () =>
      modal.classList.contains('open') ||
      modal.getAttribute('aria-hidden') === 'false';

    const applyWhenOpen = ()=>{
      if(isOpen()){
        ensureDefaultMinutes();
        styleStartButton();
        disableTimerAutoFocusOnce();
        focusStartButton(); // é–‹ã„ãŸã‚‰é–‹å§‹ãƒœã‚¿ãƒ³ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
      }
    };

    // å±æ€§å¤‰åŒ–ã‚’ç›£è¦–
    const mo2 = new MutationObserver(applyWhenOpen);
    mo2.observe(modal, { attributes:true, attributeFilter:['hidden','class','aria-hidden','style'] });

    // åˆæœŸã¯é©ç”¨ã—ãªã„ï¼ˆèª¤é–‹å°é˜²æ­¢ï¼‰
  })();

  // E2E pass è¡¨ç¤ºãƒˆã‚°ãƒ« (ç‘æƒ³ãƒšãƒ¼ã‚¸)
  (function(){
    const btn = document.getElementById('togglePassMed');
    const inp = document.getElementById('s3Passphrase');
    if(btn && inp){
      btn.addEventListener('click', () => {
        const showing = inp.type === 'text';
        inp.type = showing ? 'password' : 'text';
        btn.textContent = showing ? 'ğŸ‘' : 'ğŸ™ˆ';
      });
    }
  })();
  </script>
</body>
</html>

