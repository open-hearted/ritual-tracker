<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ritual Tracker</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="style-overrides-meditation.css">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script defer src="schedule.js"></script>
  <script defer src="meditation-cloud.js"></script>
  <style>
    .grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .cell{padding:10px;border-radius:8px;background:#f3f4f6;border:1px solid #e5e7eb}
    .cell[data-has]{ background:#d1fae5 }
    .cell.today{ border:2px solid #ef4444; box-sizing:border-box }
    .cell .markers{ display:block; margin-top:4px; color: #111; }
    .cal-mark{ display:inline-block; margin-right:6px; font-size:0.9em; line-height:1; }
  #medEditor{ position:fixed; z-index:2000; left:50%; top:50%; transform:translate(-50%,-50%); background:var(--card,#0b1220); color:#e2e8f0; padding:18px; border-radius:12px; width:min(92vw,420px); display:none; max-height:92vh; overflow:auto; -webkit-overflow-scrolling:touch; }
  #medEditor textarea{ width:100%; min-height:100px }
  /* responsive free record row: ensure add button stays visible on small screens */
  #freeRecordRow{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  #freeRecordRow input#freeLabel{ flex:1; min-width:0; }
  #freeRecordRow input#freeSec{ flex:0 0 auto; }
  #freeRecordRow button#freeAdd{ flex:0 0 auto; min-width:44px; }
  /* Ensure inputs in the modal are not rendered as password bullets on some mobile browsers */
  #medEditor input, #medEditor textarea { -webkit-text-security: none !important; }
  /* Remove native number input spinners */
  input[type=number]::-webkit-outer-spin-button,
  input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  input[type=number] { -moz-appearance: textfield; appearance: textfield; -webkit-appearance: textfield; }
  </style>
  <style>
    /* Ensure calendar is hidden when not authenticated (covers PC cases) */
    body:not([data-auth="true"]) .card.cal-card { display: none !important; }
  </style>
</head>
<body>
  <div class="top" style="display:flex;align-items:center;gap:12px;padding:12px">
    <div id="gsiButtonContainer"></div>
    <button id="signOutBtn" style="display:none">„Çµ„Ç§„É≥„Ç¢„Ç¶„Éà</button>
    <div style="flex:1"></div>
    <div id="msg" style="color:#6b7280"></div>
  </div>

  <div class="container compact" style="padding:12px">
  <div class="card cal-card" style="display:none !important">
      <div class="grid" id="dowRow"></div>
      <div class="grid" id="calGrid" aria-live="polite"></div>
      <div class="cal-head" style="margin-top:10px;display:flex;align-items:center;gap:8px">
        <button id="prevBtn">‚óÄ</button>
        <div id="monthLabel" style="font-weight:700"></div>
        <button id="nextBtn">‚ñ∂</button>
        <button id="todayBtn">‰ªäÊó•</button>
      </div>
    </div>
  </div>

  <div id="medEditor">
    <div id="editSection" style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
      <strong id="editDate" style="margin-right:8px;">-</strong>
      <div style="display:flex;gap:8px;align-items:center;flex:1;justify-content:center">
        <button data-action="record" data-kind="wake" class="time-btn" style="padding:6px 10px;border-radius:6px">Ëµ∑Â∫ä</button>
        <button data-action="record" data-kind="sleep" class="time-btn" style="padding:6px 10px;border-radius:6px">Â∞±ÂØù</button>
      </div>
      <button id="closeEditor">‚úï</button>
    </div>
    
    <!-- ÔºàÈáçË§á„Åó„Å¶„ÅÑ„Åü‰∏ãÈÉ®„ÅÆËµ∑Â∫ä/Â∞±ÂØù„Éú„Çø„É≥„ÅØ„Éò„ÉÉ„ÉÄ„Å´Áµ±ÂêàÊ∏à„Åø„ÅÆ„Åü„ÇÅÂâäÈô§Ôºâ -->

    <!-- ÊôÇÂàªÈ†ÜÁµ±‰∏ÄË°®Á§∫„Ç®„É™„Ç¢ÔºàËµ∑Â∫ä„ÉªÂ∞±ÂØù„ÅÆË°®Á§∫„Å®Á∑®ÈõÜÊ©üËÉΩ„ÇíÂê´„ÇÄÔºâ -->
    <div id="allRecordsTimeline" style="margin-bottom:8px;"></div>
    
    <!-- ÂæìÊù•„ÅÆÂÄãÂà•Ë°®Á§∫„Ç®„É™„Ç¢ÔºàÈùûË°®Á§∫Ôºâ -->
    <div class="med-sessions" id="medSessions" style="display:none;margin-bottom:4px"></div>
    <div id="exerciseList" style="display:none;margin-bottom:4px"></div>
      <div style="margin-bottom:8px;">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <label>Êó•Ë®ò</label>
          <button id="insertTimeBtn" title="ÁèæÂú®ÊôÇÂàª„ÇíÊåøÂÖ•" style="background:transparent;border:none;color:#fff;font-size:18px;line-height:1;padding:4px 6px;">üïí</button>
        </div>
        <textarea id="medDiaryText" placeholder="„É°„É¢" style="width:100%;min-height:100px"></textarea>
      </div>
      <!-- Ëá™Áî±ÂÖ•Âäõ: ‰ªñ„ÅÆË®òÈå≤„Å®Âêå„Åò„Éï„Ç©„Éº„Éû„ÉÉ„Éà„ÅßËøΩÂä†„Åß„Åç„Çã1Ë°åÊ¨Ñ -->
      <div id="freeRecordRow" style="display:flex;gap:8px;align-items:center;margin-bottom:6px">
    <input id="freeLabel" name="free_record_label" type="text" placeholder="Ë®òÈå≤ÂÜÖÂÆπÔºà‰æã: Êúù„É®„Ç¨Ôºâ" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" inputmode="text" style="flex:1;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.08);background:transparent;color:#fff" />
    <input id="freeSec" name="free_record_seconds" type="number" inputmode="numeric" min="0" placeholder="Áßí" autocomplete="off" style="width:4ch;padding:6px;text-align:center;border-radius:6px;border:1px solid rgba(255,255,255,0.08);background:transparent;color:#fff" />
        <button id="freeAdd">ËøΩÂä†</button>
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end">
      </div>

    <div id="exerciseTimers" style="display:flex;flex-direction:column;gap:8px;margin-bottom:4px">
        <div class="exercise-timer" style="display:flex;gap:8px;align-items:center;font-size:13px;padding:4px 0">
          <strong style="width:56px">„Éó„É©„É≥„ÇØ</strong>
  <input id="plankSec" type="number" min="1" value="30" style="width:4ch;padding:0 4px;text-align:center" /> Áßí
          <span id="plankDisplay" style="min-width:48px;text-align:center">--:--</span>
          <button id="plankStart">ÈñãÂßã</button>
        </div>
        <div class="exercise-timer" style="display:flex;gap:8px;align-items:center;font-size:13px;padding:4px 0">
          <strong style="width:56px">Á©∫Ê∞óÊ§ÖÂ≠ê</strong>
  <input id="wallSec" type="number" min="1" value="30" style="width:4ch;padding:0 4px;text-align:center" /> Áßí
          <span id="wallDisplay" style="min-width:48px;text-align:center">--:--</span>
          <button id="wallStart">ÈñãÂßã</button>
        </div>
      </div>
      <!-- ËøΩÂä† / Êó•„ÇØ„É™„Ç¢ „Éú„Çø„É≥„ÅØ‰∏çË¶Å„ÅÆ„Åü„ÇÅÂâäÈô§ -->
    <div class="med-timer" id="medTimerBox" style="margin-bottom:4px;display:flex;gap:8px;align-items:center;font-size:13px;padding:4px 0">
    <strong style="width:56px">ÁûëÊÉ≥</strong>
  <input id="medTimerMin" type="number" min="0.01" step="0.01" value="30" style="width:84px" />
    <span id="medTimerDisplay" style="min-width:56px;text-align:center">--:--</span>
    <button id="medTimerStart">ÈñãÂßã</button>
    <!-- „Éù„Éº„Ç∫ÊôÇ„Å´Ë°®Á§∫„Åô„Çã„ÇØ„É™„Ç¢ÔºàÁ†¥Ê£ÑÔºâ„Éú„Çø„É≥ -->
    <button id="medTimerClear" style="display:none;padding:6px 8px;border-radius:6px;background:transparent;border:1px solid rgba(255,255,255,0.08);">„ÇØ„É™„Ç¢</button>
  </div>
      
    </div>

    <script>
      // small helper to open editor when clicking outside JS-created overlay
      document.addEventListener('click', e=>{
        const ed = document.getElementById('medEditor'); if(!ed) return; if(ed.style.display==='block' && !ed.contains(e.target) && !e.target.classList.contains('cell')){ try{ if(typeof closeEditor === 'function') closeEditor(); else ed.style.display='none'; }catch{ ed.style.display='none'; } }
      });
    </script>
  </body>
  </html>
